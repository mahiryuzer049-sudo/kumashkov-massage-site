# SCANNER RCA V3

Проект: `pavelkumashkov.ru`  
Дата фиксации: 2026-02-13  
Цель: задокументировать причины поломок scanner и подтвержденные фиксы.

## Симптомы (по обратной связи владельца)

1. Клики по точкам и кнопкам быстрых зон не открывали popup.
2. При клике страница смещалась вверх (scroll jump).
3. Popup открывался нестабильно или «гас» при следующих кликах.

## Root causes (3 ключевые причины)

1. Не было гарантированной событийной модели для `SVG`-точек и `data-zone-shortcut` (часть кликов не доходила до обработчиков).
2. Отсутствовал контроль фокуса и предотвращение скролла при фокусе popup, что вызывало scroll jump.
3. Закрывающий обработчик клика не различал «клик внутри popup/точки/кнопки», что приводило к мгновенному закрытию после открытия.

## Фиксы (что внедрено)

1. Явные обработчики `click/keydown` для `.active-point` и `[data-zone-shortcut]` с `preventDefault/stopPropagation`.
2. Фокус переводится на `zoneClose` с `preventScroll` и возвращается на триггер при закрытии.
3. Глобальный обработчик клика закрывает popup только если клик вне `#zone-popup`, `.active-point` и `[data-zone-shortcut]`.
4. Добавлена визуальная логика активной зоны и поддержка медиа-слота `--zone-image`.

## Верификация (ручной чек-лист)

1. 5/5 точек на силуэте открывают popup.
2. 5/5 кнопок быстрых зон открывают popup.
3. Нет scroll jump при кликах.
4. Popup закрывается по `Esc`, клику по «×» и клику вне блока.
5. Фокус возвращается на последний триггер.

## Риски и удержание

1. Риск: будущие правки JS могут обойти обработчики или сломать focus-цикл.  
   Мера: обязательный прогон `qa:scanner` при любых изменениях `scanner.html` или `main.js`.

