import{e as w}from"./emit-event-D_28Pgnv.js";import{g as B}from"./runtime-env-BTGPA9v1.js";import{g as A}from"./viewport-BO_p0Wfw.js";const q=(M,{onMenuStateChange:m}={})=>{const{body:t,metrikaId:O}=M,{win:d,doc:i}=B();if(!d||!i)return{closeMenu:()=>{},openMenu:()=>{}};const o=i.getElementById("mobile-menu-toggle"),s=i.getElementById("mobile-menu"),r=i.getElementById("mobile-menu-overlay");if(!o||!s)return{closeMenu:()=>{},openMenu:()=>{}};let a=null,p=0;const b=(e,l={})=>w(e,l,O),h=e=>{typeof m=="function"&&m({menuOpen:e})},g=()=>Array.from(s.querySelectorAll('a,button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled")),x=()=>{A()==="mobile"&&(t.classList.contains("scroll-locked")||(p=d.scrollY||d.pageYOffset||0,t.style.position="fixed",t.style.top=`-${p}px`,t.style.left="0",t.style.right="0",t.style.width="100%",t.classList.add("scroll-locked"),i.documentElement.classList.add("scroll-locked")))},S=()=>{t.classList.contains("scroll-locked")&&(t.classList.remove("scroll-locked"),t.style.position="",t.style.top="",t.style.left="",t.style.right="",t.style.width="",i.documentElement.classList.remove("scroll-locked"),d.scrollTo(0,p))},c=()=>{if(o.getAttribute("aria-expanded")==="true"){if(S(),o.setAttribute("aria-expanded","false"),s.classList.add("hidden"),s.setAttribute("aria-hidden","true"),s.dataset.open="false",t.classList.remove("menu-open"),h(!1),b("menu_close",{source:"mobile"}),r&&(r.classList.remove("is-open"),r.setAttribute("aria-hidden","true"),r.classList.add("hidden")),a&&typeof a.focus=="function")try{a.focus({preventScroll:!0})}catch{a.focus()}a=null}},y=()=>{a=i.activeElement,o.setAttribute("aria-expanded","true"),s.classList.remove("hidden"),s.setAttribute("aria-hidden","false"),s.dataset.open="true",t.classList.add("menu-open"),x(),h(!0),b("menu_open",{source:"mobile"}),r&&(r.classList.remove("hidden"),r.classList.add("is-open"),r.setAttribute("aria-hidden","false"));const e=g();e.length&&requestAnimationFrame(()=>{try{e[0].focus({preventScroll:!0})}catch{e[0].focus()}})};o.addEventListener("click",()=>{o.getAttribute("aria-expanded")==="true"?c():y()}),s.querySelectorAll("a").forEach(e=>{e.addEventListener("click",c)}),i.addEventListener("click",e=>{if(!(o.getAttribute("aria-expanded")==="true"))return;const n=e.target.closest("#mobile-menu"),u=e.target.closest("#mobile-menu-toggle");!n&&!u&&c()}),r&&r.addEventListener("click",c);const Y=e=>{o.getAttribute("aria-expanded")==="true"&&(s.contains(e.target)||e.preventDefault())};i.addEventListener("touchmove",Y,{passive:!1});let v=0,L=0,f=!1;return s.addEventListener("touchstart",e=>{if(!(o.getAttribute("aria-expanded")==="true"))return;const n=e.touches[0];n&&(v=n.clientY,L=n.clientX,f=!0)},{passive:!0}),s.addEventListener("touchmove",e=>{if(!f)return;const l=e.touches[0];if(!l)return;const n=l.clientY-v,u=l.clientX-L;Math.abs(n)<60||Math.abs(n)<Math.abs(u)||n>0&&s.scrollTop<=0&&(f=!1,c())},{passive:!0}),s.addEventListener("touchend",()=>{f=!1}),i.addEventListener("keydown",e=>{if(e.key==="Escape"&&c(),!(o.getAttribute("aria-expanded")==="true")||e.key!=="Tab")return;const n=g();if(!n.length)return;const u=n[0],E=n[n.length-1],k=i.activeElement;e.shiftKey&&k===u?(e.preventDefault(),E.focus()):!e.shiftKey&&k===E&&(e.preventDefault(),u.focus())}),d.addEventListener("resize",()=>{A()!=="mobile"&&c()}),{closeMenu:c,openMenu:y}};export{q as initMobileMenu};
