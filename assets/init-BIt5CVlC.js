import{e as $}from"./emit-event-D_28Pgnv.js";import{s as j}from"./anchor-CugRdubv.js";import{g as z}from"./runtime-env-BTGPA9v1.js";import{g as F}from"./viewport-BO_p0Wfw.js";const V=H=>{const{body:S,metrikaId:O,reducedEffects:M}=H,{win:l,doc:a,loc:I}=z();if(!l||!a||!I){const e=()=>{};return{navState:{},updateNavState:e,emitNavEvent:e,navigateToAnchor:()=>!1,scheduleNavJumpCheck:e,setPendingNavJump:e}}const v=a.getElementById("navbar"),u=a.querySelector("[data-nav-primary]"),g=u?u.querySelector(".nav-highlight"):null,b=u?Array.from(u.querySelectorAll("[data-nav-section]")):[],A=a.getElementById("nav-progress"),w=a.getElementById("mobile-active-section"),h=a.querySelector(".section-rail"),B=a.getElementById("rail-current"),P=a.getElementById("rail-next"),C=h?Array.from(h.querySelectorAll("[data-nav-section]")):[],m=(e,r={})=>$(e,r,O),d={currentSectionId:"",scrollProgress:0,viewportMode:F(),menuOpen:!1,contextIntent:"explore",reducedMotion:M},y=e=>{Object.assign(d,e),d.currentSectionId&&(S.dataset.activeSection=d.currentSectionId),d.contextIntent&&(S.dataset.navIntent=d.contextIntent),Number.isFinite(d.scrollProgress)&&S.style.setProperty("--nav-scroll",d.scrollProgress.toFixed(4))};l.addEventListener("resize",()=>{y({viewportMode:F()})});const c=C.map(e=>e.dataset.navSection).filter(Boolean),q=new Map(C.map(e=>[e.dataset.navSection,e.dataset.label||e.getAttribute("aria-label")||(e.textContent||"").trim()||""])),R=e=>{if(!B||!P||!c.length)return;const r=c.indexOf(e),o=r>=0?e:c[0],t=r>=0&&r<c.length-1?c[r+1]:c[c.length-1];B.textContent=q.get(o)||o,P.textContent=q.get(t)||"Финал"},J={home:"explore",trust:"explore",services:"compare",scanner:"explore","goal-routes":"compare",packages:"compare",results:"explore",blog:"explore","how-to-book":"book",booking:"book"},_=e=>J[e]||"explore",p=Array.from(a.querySelectorAll("[data-nav-section]")),T=(e,r="nav")=>{if(!e||e==="#")return!1;let o;try{o=new URL(e,I.href)}catch{return!1}if(!o.hash||o.pathname!==I.pathname)return!1;const t=o.hash.replace("#",""),n=a.getElementById(t);return n?(m("nav_jump",{id:t,source:r}),s={id:t,source:r,aliases:t.endsWith("-anchor")?[t.replace(/-anchor$/,"")]:[]},N(),j(n,{reducedEffects:M})):!1};p.forEach(e=>{e.addEventListener("click",r=>{const o=e.getAttribute("href")||"",t=T(o,"nav");t&&r.preventDefault(),t||m("nav_click",{href:o,source:"nav"})})});let s=null,f=null;const N=()=>{s&&(f&&clearTimeout(f),f=setTimeout(()=>{s&&(m("nav_jump_miss",{id:s.id,source:s.source}),s=null)},2e3))};if(p.length&&"IntersectionObserver"in window){const e=new Map;p.forEach(t=>{const n=t.dataset.navSection||"";!n||!a.getElementById(n)||(e.has(n)||e.set(n,[]),e.get(n).push(t))});const r=Array.from(e.keys()).map(t=>a.getElementById(t)).filter(Boolean),o=t=>{if(p.forEach(n=>{const i=n.dataset.navSection===t;n.classList.toggle("is-active",i),n.setAttribute("aria-current",i?"true":"false")}),w){const n=p.find(L=>L.dataset.navSection===t),i=n?(n.textContent||"").trim():"";i&&(w.textContent=i)}E(),R(t),y({currentSectionId:t,contextIntent:_(t)}),s&&(s.id===t||s.aliases&&s.aliases.includes(t))&&(m("nav_jump_success",{id:t,source:s.source}),s=null,f&&(clearTimeout(f),f=null))};if(r.length){const t=new IntersectionObserver(n=>{n.forEach(i=>{if(!i.isIntersecting)return;const L=i.target.id;o(L)})},{rootMargin:"-35% 0px -55% 0px",threshold:.01});r.forEach(n=>t.observe(n))}}c.length&&R(c[0]);function x(e){if(!u||!g)return;if(!e){g.style.opacity="0";return}const r=e.getBoundingClientRect(),o=u.getBoundingClientRect(),t=Math.max(r.left-o.left,0);g.style.width=`${r.width}px`,g.style.transform=`translateX(${t}px)`,g.style.opacity="1"}function E(){if(!b.length)return;const e=u.querySelector("[data-nav-section].is-active");if(!e){x(null);return}x(e)}b.length&&(b.forEach(e=>{e.addEventListener("mouseenter",()=>x(e)),e.addEventListener("focus",()=>x(e))}),u.addEventListener("mouseleave",E),l.addEventListener("resize",()=>l.requestAnimationFrame(E)),l.requestAnimationFrame(E));let k=0;if(v||A){let e=!1;const r=()=>{e||(e=!0,l.requestAnimationFrame(()=>{const o=l.scrollY||0;if(v&&v.classList.toggle("nav-compact",o>12),A){const t=a.documentElement,n=t.scrollHeight-t.clientHeight,i=n>0?Math.min(o/n,1):0;A.style.transform=`scaleX(${i})`,h&&h.style.setProperty("--rail-progress",i.toFixed(4)),y({scrollProgress:i})}if(v){const t=v.getBoundingClientRect().height;Math.abs(t-k)>1&&(a.documentElement.style.setProperty("--anchor-offset",`${Math.round(t+12)}px`),k=t)}e=!1}))};l.addEventListener("scroll",r,{passive:!0}),r()}return{navState:d,updateNavState:y,emitNavEvent:m,navigateToAnchor:T,scheduleNavJumpCheck:N,setPendingNavJump:e=>{s=e,N()}}};export{V as initNav};
