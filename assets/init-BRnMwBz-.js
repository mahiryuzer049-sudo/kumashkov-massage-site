import{e as R}from"./emit-event-D_28Pgnv.js";import{s as _}from"./anchor-CugRdubv.js";import{g as j}from"./runtime-env-BTGPA9v1.js";const M=(w,{closeMenu:v}={})=>{const{body:A,metrikaId:I,reducedEffects:D}=w,{win:h,doc:n,loc:g}=j();if(!h||!n||!g)return;const s=n.getElementById("nav-command"),m=n.getElementById("nav-command-input"),u=n.getElementById("nav-command-list"),L=n.getElementById("nav-command-close"),p=Array.from(n.querySelectorAll("[data-command-trigger]"));if(!s)return;const y=(e,a={})=>R(e,a,I),S="Ничего не найдено",T=()=>Array.from(s.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled"));p.forEach(e=>{e.hasAttribute("aria-controls")||e.setAttribute("aria-controls","nav-command"),e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false")});const q=Array.from(n.querySelectorAll("[data-nav-section]")),k=(e,a="command")=>{if(!e||e==="#")return!1;let t;try{t=new URL(e,g.href)}catch{return!1}if(!t.hash||t.pathname!==g.pathname)return!1;const r=t.hash.replace("#",""),c=n.getElementById(r);return c?(y("nav_jump",{id:r,source:a}),_(c,{reducedEffects:D})):!1},B={home:["home","start"],trust:["format","first"],services:["services","classic","relax","lymph","posture"],scanner:["scanner","zones","diagnostic"],"goal-routes":["routes","scenarios"],packages:["packages","plans"],results:["results","effect"],blog:["blog","guides"],"how-to-book":["booking","how"],booking:["contact","message"]},K=(()=>{const e=new Map;return q.forEach(a=>{const t=a.dataset.navSection||"";if(!t)return;const r=(a.textContent||"").trim()||a.dataset.label||a.getAttribute("aria-label")||t,c=a.getAttribute("href")||"";if(!(!c||!r)&&!e.has(t)){const o=B[t]||[],C=(a.dataset.search||"").trim(),N=[r,t,...o,C].join(" ").toLowerCase();e.set(t,{id:t,label:r,href:c,search:N})}}),Array.from(e.values())})();let l=[],i=0,f=null;const x=(e="")=>{if(!u)return;const a=e.trim().toLowerCase();if(u.innerHTML="",l=K.filter(t=>t.search.includes(a)),!l.length){const t=n.createElement("li");t.className="nav-command-empty",t.textContent=S,u.appendChild(t);return}l.forEach((t,r)=>{const c=n.createElement("li"),o=n.createElement("button");o.type="button",o.className="nav-command-item",o.dataset.index=String(r),o.dataset.href=t.href,o.innerHTML=`${t.label}<span>${t.id}</span>`,o.addEventListener("click",()=>{k(t.href,"command")||(h.location.href=t.href),d()}),c.appendChild(o),u.appendChild(c)}),i=0,b(i)},b=e=>{if(!u)return;Array.from(u.querySelectorAll(".nav-command-item")).forEach((t,r)=>{t.classList.toggle("is-active",r===e)})},E=()=>{f=n.activeElement,typeof v=="function"&&v(),s.classList.remove("hidden"),s.classList.add("is-open"),s.setAttribute("aria-hidden","false"),A.classList.add("command-open"),p.forEach(e=>e.setAttribute("aria-expanded","true")),y("menu_open",{source:"command"}),m&&(m.value="",x(""),h.requestAnimationFrame(()=>m.focus()))},d=()=>{if(s.classList.contains("is-open")){if(s.classList.remove("is-open"),s.classList.add("hidden"),s.setAttribute("aria-hidden","true"),A.classList.remove("command-open"),p.forEach(e=>e.setAttribute("aria-expanded","false")),y("menu_close",{source:"command"}),f&&typeof f.focus=="function")try{f.focus({preventScroll:!0})}catch{f.focus()}f=null}};return s.addEventListener("click",e=>{e.target===s&&d()}),L&&L.addEventListener("click",d),p.forEach(e=>e.addEventListener("click",E)),m&&(m.addEventListener("input",e=>{x(e.target.value||"")}),m.addEventListener("keydown",e=>{if(e.key==="Escape"){e.preventDefault(),d();return}if(l.length&&(e.key==="ArrowDown"&&(e.preventDefault(),i=(i+1)%l.length,b(i)),e.key==="ArrowUp"&&(e.preventDefault(),i=(i-1+l.length)%l.length,b(i)),e.key==="Enter")){e.preventDefault();const a=l[i];a&&(k(a.href,"command")||(h.location.href=a.href),d())}})),n.addEventListener("keydown",e=>{const a=s.classList.contains("is-open");if(a&&e.key==="Tab"){const t=T();if(!t.length)return;const r=t[0],c=t[t.length-1],o=n.activeElement;e.shiftKey&&o===r?(e.preventDefault(),c.focus()):!e.shiftKey&&o===c&&(e.preventDefault(),r.focus())}if(a&&e.key==="Escape"){e.preventDefault(),d();return}(e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="k"&&(e.preventDefault(),E())}),{openCommand:E,closeCommand:d}};export{M as initCommandPalette};
